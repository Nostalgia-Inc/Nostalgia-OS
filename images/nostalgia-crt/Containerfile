# 1) Switch base to the Deck edition
FROM ghcr.io/ublue-os/bazzite-deck:latest

LABEL org.opencontainers.image.title="Nostalgia OS"
LABEL org.opencontainers.image.description="Deck-style Gaming Mode with Nostalgia branding"
LABEL org.opencontainers.image.authors="Nostalgia Inc."
LABEL org.opencontainers.image.source="https://github.com/Nostalgia-Inc/Nostalgia-OS"

# 2) Branding (Plymouth + your shared assets)
COPY common/                                   /usr/share/nostalgia/
COPY images/nostalgia-crt/plymouth/nostalgia   /usr/share/plymouth/themes/nostalgia

# Pick Nostalgia plymouth at boot
RUN install -d /etc/plymouth && \
    printf '%s\n[Daemon]\nTheme=nostalgia\nShowDelay=0\n' > /etc/plymouth/plymouthd.conf

# 3) (Optional) SDDM theme selection for login background
#    Only keep if you ship /usr/share/sddm/themes/nostalgia
# COPY images/nostalgia-crt/sddm/nostalgia /usr/share/sddm/themes/nostalgia
# RUN install -d /etc/sddm.conf.d && \
#     printf '%s\n[Theme]\nCurrent=nostalgia\n' > /etc/sddm.conf.d/10-nostalgia-theme.conf

# 4) First-boot: slim down to *your* extras (Arduino, wallpaper, hostname suffix)
COPY images/nostalgia-crt/firstboot/10-nostalgia-setup.sh       /usr/lib/nostalgia/10-firstboot.sh
COPY images/nostalgia-crt/firstboot/nostalgia-firstboot.service /usr/lib/systemd/system/nostalgia-firstboot.service
RUN chmod +x /usr/lib/nostalgia/10-firstboot.sh && \
    ln -sv /usr/lib/systemd/system/nostalgia-firstboot.service \
           /etc/systemd/system/multi-user.target.wants/nostalgia-firstboot.service || true

# 5) (Optional) Boot / shutdown videos used by your first-boot or session scripts
#    You can still ship them for later use if desired:
# COPY images/nostalgia-crt/gamescope/media/ /usr/share/nostalgia/media/

# 6) Any extra tools you want on the base image (mpv is handy for playing clips)
RUN rpm-ostree install mpv && ostree container commit
